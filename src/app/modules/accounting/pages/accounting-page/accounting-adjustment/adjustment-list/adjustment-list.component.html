<div showControl [hasPermission]="1" class="w-full flex flex-col mt-5 gap-2">
  <div id="#adjusestment" class="flex items-center justify-between mb-4">
    <h2 class="mb-4 text-2xl font-extrabold leading-none tracking-tight text-gray-900 md:text-3xl lg:text-4xl">
      Lista de Ajustes
    </h2>

    <button [ngClass]="selectRows.length > 0 && isApprove ? 'visible' : 'hidden'"
      class="font-medium rounded-lg text-sm px-5 py-2 me-2 mb-2 text-white bg-green-600 hover:bg-green-700 disabled:bg-green-300 disabled:opacity-50"
      (click)="posting()">
      Confirmar
    </button>
  </div>

  <div class="w-full">
    <dx-data-grid id="gridContainer" keyExpr="id" [dataSource]="dataSource$ | async" [repaintChangesOnly]="true"
      [loadPanel]="{ enabled: true }" [allowColumnReordering]="true" [rowAlternationEnabled]="true"
      [allowColumnResizing]="true" [allowColumnReordering]="true" [showBorders]="true" [width]="'100%'"
      [height]="'600px'" (onSelectionChanged)="onRowSelected($event)">

      <dxo-selection [selectAllMode]="allMode" [showCheckBoxesMode]="checkBoxesMode" mode="multiple"></dxo-selection>
      <dxo-sorting mode="multiple"></dxo-sorting>
      <dxo-header-filter [visible]="true"></dxo-header-filter>
      <dxo-paging [pageSize]="15"></dxo-paging>
      <dxo-pager [showPageSizeSelector]="true" [allowedPageSizes]="[10, 25, 50, 100]"></dxo-pager>
      <dxo-search-panel [visible]="true" [highlightCaseSensitive]="true"></dxo-search-panel>
      <dxo-group-panel [visible]="true"></dxo-group-panel>

      <dxi-column caption="No. Factura" alignment="center" dataField="invoiceNo"></dxi-column>
      <dxi-column caption="Referencia" alignment="center" dataField="reference"></dxi-column>
      <dxi-column caption="Descripción" alignment="center" dataField="descriptionAdjustment"></dxi-column>

      <dxi-column caption="Estado" dataField="statusLabel" alignment="center"></dxi-column>

      <dxi-column caption="Fecha Creación" dataField="creationDate" dataType="date" alignment="center"
        format="dd/MM/yyyy" width="150">
      </dxi-column>


      <dxi-column type="buttons" cellTemplate="cellButtonsTemplate" width="80">
        <div *dxTemplate="let row of 'cellButtonsTemplate'">
          <!-- Editar si es Borrador; Ver si está Confirmado -->
          <button *ngIf="row.data.isDraft; else viewBtn" type="button" title="Editar"
            class="dx-link dx-icon-edit dx-link-icon" (click)="onButtonClick(row.data)">
          </button>
          <ng-template #viewBtn>
            <button type="button" title="Ver" class="dx-link dx-icon-description dx-link-icon"
              (click)="onButtonClick(row.data)">
            </button>
          </ng-template>
        </div>
      </dxi-column>

      <dxo-toolbar>
        <dxi-item location="before">
          <dx-select-box class="mt-2" id="select-all-mode" [dataSource]="selectOptions" displayExpr="name"
            valueExpr="id" [(value)]="allMode">
          </dx-select-box>
        </dxi-item>

        <dxi-item name="groupPanel"></dxi-item>
        <dxi-item name="searchPanel"></dxi-item>

        <dxi-item location="after" *ngIf="isRegistreAccounting">
          <dx-button icon="add" hint="Nuevo ajuste" (onClick)="goToAdjustment()"></dx-button>
        </dxi-item>
      </dxo-toolbar>
    </dx-data-grid>
  </div>
</div>

<dx-toast [(visible)]="showToast" [type]="toastType" [message]="messageToast">
  <dxo-position my="top" at="top" of="#adjusestment"></dxo-position>
</dx-toast>